{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Accueil","text":""},{"location":"#_1","title":"Accueil","text":""},{"location":"#application-dannotations-de-photos-et-de-cartographie-automatisee-v11","title":"Application d\u2019annotations de photos et de cartographie automatis\u00e9e v1.1","text":""},{"location":"#description-rapide","title":"Description rapide","text":"<p>Cette application permet : - d\u2019annoter des photos et de marquer des objets - de g\u00e9n\u00e9rer automatiquement un GeoPackage des \u00e9l\u00e9ments annot\u00e9s sur les images, soit par cartographie, soit par une mise \u00e0 jour des g\u00e9om\u00e9tries du GPKG de r\u00e9f\u00e9rence, fourni par l'utilisateur  </p> <p>L\u2019outil a \u00e9t\u00e9 con\u00e7u pour un traitement 100 % Python, compatible avec une utilisation locale.  </p> <p>Joseph Jacquet | Carte et Liens | GitHub | contact@carteetliens.fr | 2025 </p>"},{"location":"#_2","title":"Accueil","text":""},{"location":"config/","title":"Param\u00e9trages suppl\u00e9mentaires","text":""},{"location":"config/#definir-le-fov-et-le-chemin-des-photos-par-defaut","title":"D\u00e9finir le FOV et le chemin des photos par d\u00e9faut","text":"<p>Afin de ne pas avoir \u00e0 saisir le chemin du dossier de projet ainsi que le FOV de l'appareil, il est possible d'ajouter des valeurs par d\u00e9faut dans le main.py :</p> <p>Ligne 93 \u2013 Chemin vers le dossier photos : <pre><code>image_folder = st.text_input(\"Copiez le chemin du dossier contenant les images\", r\"votre\\\\chemin\\\\par\\\\d\u00e9faut\")\n</code></pre></p> <p>Ligne 170 \u2013 Modifier la valeur de value=\"\" pour appliquer une valeur par d\u00e9faut \u00e0 chaque initialisation : <pre><code>fov_user = st.number_input(\"Champ de vision (FOV en degr\u00e9s)\", min_value=70.0, max_value=180.0, value=100.0, step=0.1, key=\"fov_input\")\n</code></pre></p>"},{"location":"config/#utilisation-dune-base-postgres-pour-recuperer-les-resultats","title":"Utilisation d'une base Postgres pour r\u00e9cup\u00e9rer les r\u00e9sultats","text":"<p>L'utilisateur pourra injecter les donn\u00e9es sur une base Postgres au lieu de g\u00e9n\u00e9rer un gpkg. Les vues et fonctions n\u00e9cessaires seront partag\u00e9es ult\u00e9rieurement.</p> <p>Info</p> <p>[En cours de d\u00e9veloppement]</p>"},{"location":"config/#utilisation-dun-masque-de-distorsion-pour-aplanir-les-photos","title":"\u200bUtilisation d'un masque de distorsion pour aplanir les photos","text":"<p>L'utilisateur pourra appliquer un masque de distorsion afin de limiter la d\u00e9formation des images et disposer d'une pr\u00e9cision accrue pour la cartographie. </p> <p>Info</p> <p>[En cours de d\u00e9veloppement]</p>"},{"location":"config/#utilisation-dun-modele-machine-learning-pour-pre-detecter-des-elements-sur-les-photos","title":"Utilisation d'un mod\u00e8le Machine Learning pour pr\u00e9-d\u00e9tecter des \u00e9l\u00e9ments sur les photos","text":"<p>L'utilisateur pourra pr\u00e9-traiter ses photos en amont afin qu'elles soient d\u00e9j\u00e0 annot\u00e9es.</p> <p>Info</p> <p>[En cours de d\u00e9veloppement] </p>"},{"location":"credits/","title":"Cr\u00e9dits des images de test","text":"<p>Les images situ\u00e9es dans le dossier <code>data_test/</code> proviennent de la plateforme Panoramax.</p> <ul> <li>Localisation : La Rochelle - Charente-Maritime (17)</li> <li>Auteur : StephaneP</li> <li>Id de la s\u00e9quence : 3f96fa8b-e07f-43c9-9f0f-ee359728d99a</li> </ul> Photo (date_test) Id Panoramax img_test_panoramx_1.jpg f4a48ee5-1a38-4504-8591-8cf247561851 img_test_panoramx_2.jpg d6362e0a-e35e-4065-8a10-5f569bfc5c69 img_test_panoramx_3.jpg 9e121a26-cd29-48b4-b10b-ca1476784581 img_test_panoramx_4.jpg cb879720-aec2-4c2b-bdde-f46c60c34e4b img_test_panoramx_5.jpg 95e26044-175e-45f5-b3cf-7c24a90a8816 img_test_panoramx_6.jpg 6f3b5490-1913-45bc-9474-05afbc578cc9 <ul> <li>Plateforme : Panoramax</li> <li>Licence : CC-BY-SA 4.0</li> </ul> <p>Merci au contributeur pour le partage de ces images dans un cadre libre.  </p>"},{"location":"installation/","title":"Installation","text":"<p>L'application est pr\u00e9vue pour une utilisation locale.</p>"},{"location":"installation/#installation","title":"Installation","text":""},{"location":"installation/#1-cloner-le-depot","title":"1. Cloner le d\u00e9p\u00f4t","text":"<pre><code>git clone https://github.com/Carteetliens/photomapon.git\ncd photomapon\n</code></pre>"},{"location":"installation/#2-installer-les-dependances","title":"2. Installer les d\u00e9pendances","text":"<pre><code>pip install -r requirements.txt\n</code></pre>"},{"location":"installation/#3-lancer-lapplication","title":"3. Lancer l\u2019application","text":"<pre><code>streamlit run main.py\n</code></pre> <p>Optionnel : vous pouvez \u00e9galement ex\u00e9cuter launch.bat pour automatiser le lancement (\u00e0 garder dans le dossier de l'interface, cr\u00e9er un raccourci pour l'ex\u00e9cuter ailleurs) <pre><code>@echo off\nstreamlit run [chemin_vers_main.py]/main.py\npause\n</code></pre></p>"},{"location":"installation/#4-utiliser-les-donnees-de-test","title":"4. Utiliser les donn\u00e9es de test","text":"<p>Pour utiliser les donn\u00e9es test, r\u00e9f\u00e9rez-vous \u00e0 la page Principe de base Copiez simplement le chemin du dossier /data_tes dans l'application : [chemin_vers_dossier/data_set]  </p>"},{"location":"licence/","title":"Licence","text":""},{"location":"licence/#_1","title":"Licence","text":"<p>Photo'Mapon Copyright (C) 2025 Joseph JACQUET</p> <p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p> <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p> <p>You should have received a copy of the GNU General Public License along with this program. If not, see https://www.gnu.org/licenses/.</p> <p>Ce programme est un logiciel libre : vous pouvez le redistribuer et/ou le modifier selon les termes de la Licence Publique G\u00e9n\u00e9rale GNU telle que publi\u00e9e par la Free Software Foundation, soit la version 3 de la Licence, soit (\u00e0 votre gr\u00e9) toute version ult\u00e9rieure.</p> <p>Ce programme est distribu\u00e9 dans l'espoir qu'il sera utile, mais SANS AUCUNE GARANTIE ; sans m\u00eame la garantie implicite de COMMERCIALISABILIT\u00c9 ou D'AD\u00c9QUATION \u00c0 UN USAGE PARTICULIER. Voir la Licence Publique G\u00e9n\u00e9rale GNU pour plus de d\u00e9tails.</p> <p>Vous devriez avoir re\u00e7u une copie de la Licence Publique G\u00e9n\u00e9rale GNU avec ce programme. Si ce n'est pas le cas, voir https://www.gnu.org/licenses/.</p> <p>Joseph Jacquet | Carte et Liens | GitHub | contact@carteetliens.fr</p>"},{"location":"licence/#licences-des-bibliotheques-tierces","title":"Licences des biblioth\u00e8ques tierces","text":"<p>Ce projet utilise les biblioth\u00e8ques suivantes :</p> Biblioth\u00e8que Licence Remarques streamlit Apache 2.0 Compatible avec GPL streamlit_image_coordinates MIT Compatible avec GPL pandas BSD 3-Clause Compatible avec GPL geopandas BSD 3-Clause Compatible avec GPL shapely BSD 3-Clause Compatible avec GPL pyproj MIT Compatible avec GPL pillow (PIL) MIT-CMU Compatible avec GPL scipy BSD Compatible avec GPL fiona BSD 3-Clause Compatible avec GPL"},{"location":"licence/#la-liste-complete-des-dependances-figure-dans-le-fichier-requirementstxt","title":"La liste compl\u00e8te des d\u00e9pendances figure dans le fichier <code>requirements.txt</code>.","text":""},{"location":"maj/","title":"Changelog","text":""},{"location":"maj/#version-11-2025-11","title":"[Version 1.1] - 2025-11","text":""},{"location":"maj/#nouvelles-fonctionnalites","title":"Nouvelles fonctionnalit\u00e9s","text":"Mise \u00e0 jour Int\u00e9gration d'une visionneuse pour les photos 360\u00b0 (Pannelum) : ajout/modification/suppression d'annotations Recherche d'une photo sp\u00e9cifique dans le dossier pour affichage Gestion utilisateur du d\u00e9calage pour un r\u00e9f\u00e9rentiel nord = 0\u00b0"},{"location":"maj/#changement-dans-linterface","title":"Changement dans l'interface","text":"Mise \u00e0 jour Changement de place du bouton de r\u00e9initialisation des annotations d\u2019une image sous le tableau d'annotations Ajout d\u2019un compteur de photos ( n\u00b0x/x dans le dossier : tri alphab\u00e9tique) Ajout de la barre de recherche au-dessus de la visionneuse photo Ajout du compteur pour d\u00e9finir la valeur du d\u00e9calage de la direction de la photo dans la barre lat\u00e9rale"},{"location":"maj/#corrections-bugs","title":"Corrections / bugs","text":"<p>/</p> <p>Projet d\u00e9velopp\u00e9 par Joseph Jacquet - Carte et Liens - 2025</p> <p>Pour toute question, suggestion ou demande professionnelle : contact@carteetliens.fr | Carte et Liens</p>"},{"location":"utilisation/","title":"Principe de base","text":""},{"location":"utilisation/#1-prerequis-avant-lutilisation-de-lapplication","title":"1. Pr\u00e9requis avant l'utilisation de l'application","text":"<p>L'application permet d'utiliser des photos standards et des photos \u00e0 360\u00b0. Privil\u00e9giez un dossier par type de photos (standards et 360\u00b0) et par source afin d'\u00e9viter les d\u00e9calages si les photos n'ont pas \u00e9t\u00e9 prises avec le m\u00eame appareil ou avec les m\u00eames param\u00e8tres.</p>"},{"location":"utilisation/#disposer-du-chemin-vers-un-dossier-photo-et-connaitre-le-fov-de-limage","title":"Disposer du chemin vers un dossier photo et conna\u00eetre le FOV de l'image","text":"<p>Les photos doivent contenir des donn\u00e9es EXIF exploitables et pr\u00e9cises pour garantir un rendu fiable (pr\u00e9cision minimum conseill\u00e9e : &lt; 1 m pour les coordonn\u00e9es + direction).</p> <p>Pour les photos standards : Il est n\u00e9cessaire de conna\u00eetre la valeur du FOV (champ de vision) de l\u2019appareil photo. Cette valeur est \u00e0 renseigner dans la barre lat\u00e9rale de l\u2019interface.    </p> <p>Tip</p> <p>Figer le chemin et le FOV dans main.py si fr\u00e9quemment utilis\u00e9 Voir la page Param\u00e9trages suppl\u00e9mentaires </p>"},{"location":"utilisation/#fournir-un-fichier-yaml-de-configuration-annotations_configyaml","title":"Fournir un fichier YAML de configuration (annotations_config.yaml)","text":"<p>Il doit prendre le nom \"annotations_config.yaml\" et doit \u00eatre plac\u00e9 dans le m\u00eame dossier que vos photos. Un exemple pr\u00eat \u00e0 l\u2019emploi est fourni dans le dossier /data_test.</p> <p>\ud83d\udcc4 Structure attendue :</p> <pre><code>annotations:\n\u00a0 type_objet1:\n\u00a0 \u00a0 fonction_objet: [\"fonction1\", \"fonction2\"]\n\u00a0 \u00a0 mode_annotation: [\"mode1\"]\n\u00a0 type_objet2:\n\u00a0 \u00a0 fonction_objet: [\"fonction1\", \"fonction2\"]\n\u00a0 \u00a0 mode_annotation: [\"mode1\"]\n\u00a0 type_objet3:\n\u00a0 \u00a0 fonction_objet: [\"fonction1\", \"fonction2\"]\n\u00a0 \u00a0 mode_annotation: [\"mode2\"]\n</code></pre> <p>\ud83d\udd0e Explication des champs :</p> Champs Sous-Champs Description Exemple <code>[mode_annotation]</code> <code>cartographie</code> Cr\u00e9ation de point li\u00e9 \u00e0 une table du GPKG (ex : porte li\u00e9e \u00e0 un b\u00e2timent) - <code>[mode_annotation]</code> <code>maj_objet</code> Mise \u00e0 jour attributaire d\u2019une g\u00e9om\u00e9trie existante (colonne = type_objet,valeur = fonction_objet) - <code>[type_objet]</code> - Type explicite de l\u2019objet annot\u00e9 <code>\"porte\"</code>, <code>\"toiture\"</code>, etc. <code>[fonction_objet]</code> - Valeur de pr\u00e9cision li\u00e9e \u00e0 l\u2019objet <code>\"entr\u00e9e\"</code>, <code>\"garage\"</code>, etc. <p>Info</p> <p>Vous pouvez modifier le contenu du YAML pendant une session. Vous devrez recharger le fichier via le bouton dans la barre lat\u00e9rale  </p> <p></p>"},{"location":"utilisation/#2-utilisation-de-lapplication","title":"2. Utilisation de l'application","text":""},{"location":"utilisation/#demarrer-lapplication","title":"D\u00e9marrer l\u2019application","text":"<p>Copier le chemin du dossier contenant les images dans le champ pr\u00e9vu et d\u00e9finissez, si besoin, la valeur du FOV de vos images.  </p> Chemin des photos Valeur du FOV <p>L\u2019application va automatiquement :</p> <ul> <li>g\u00e9n\u00e9rer un fichier exif_data.json (m\u00e9tadonn\u00e9es des images),</li> <li>cr\u00e9er un fichier annotations.json \u00e0 la premi\u00e8re annotation.</li> </ul> <p>Info</p> <p>Ces fichiers se trouvent dans le dossier photo et doivent y rester pour \u00eatre exploit\u00e9s par l'application.  Si vous modifiez le contenu du dossier photo, vous devez recalculer les exifs notamment dans le cas d'un ajout.  </p> <p></p> <p>Gestion automatique des bandes noires [pour les photos standards]</p> <p>Le FOV exploitable de la photo est fix\u00e9 \u00e0 70\u00b0.  </p> <p>Note</p> <p>Exemple : Si votre image a un FOV de 100\u00b0 (d\u00e9fini dans la barre lat\u00e9rale), l\u2019application rogne automatiquement les 15\u00b0 de chaque c\u00f4t\u00e9 pour ne conserver que la zone au centre d'un FOV de 70\u00b0. Vous pouvez ajouter des annotations dans cette zone mais elles seront exclues du traitement final.</p>"},{"location":"utilisation/#ajouter-des-annotations","title":"Ajouter des annotations","text":"<p>Dans la barre lat\u00e9rale, s\u00e9lectionnez :</p> <ul> <li>le mode (cartographie ou maj_objet)</li> <li>le type d\u2019objet</li> <li>sa fonction  </li> </ul> <p> </p> <p>Note</p> <p>Les listes sont automatiquement filtr\u00e9es selon le fichier annotations_config.yaml : - par cible - par type_objet</p> <p>Cliquez sur l\u2019image \u00e0 l\u2019endroit souhait\u00e9. </p> <p>Pour les images standards : effectuez un clic-gauche Pour les images \u00e0 360\u00b0 : clic-droit pour ajouter une annotation </p> <p>Info</p> <p>Les annotations sont sauvegard\u00e9es automatiquement dans le json \u00e0 chaque clic Les objets en doublons (un m\u00eame objets sur deux images) sont moyenn\u00e9s pour ne garder qu'un seul \u00e9l\u00e9ment lors du traitement final Il se peut que les doublons entre deux images soient maintenus en fonction de leur distance (tri attributaire et spatial) </p>"},{"location":"utilisation/#gestion-des-annotations","title":"Gestion des annotations","text":"<p>Vous pouvez :</p> <ul> <li>s\u00e9lectionner une annotation pour modifier ses attributs</li> <li>supprimer une annotation.  </li> </ul> <p>Note</p> <p>Il n\u2019est pas possible de d\u00e9placer une annotation dynamiquement : supprimez-la puis recr\u00e9ez-la au bon endroit.  </p> Tableau et s\u00e9lection d'une annotation S\u00e9lection visible \u00e0 l'\u00e9cran (en jaune) <p>Vous pouvez \u00e9galement supprimer l'ensemble des annotations d'une image gr\u00e2ce au bouton sous le tableau Bug visuel possible donnant l'impression qu'il reste une annotation malgr\u00e9 la suppression totale. Si le tableau est vide alors toutes les annotations ont \u00e9t\u00e9 supprim\u00e9es. </p> <p>Warning</p> <p>Faites une sauvegarde du json d'annotations avant chaque session La r\u00e9initialisation des annotations d'une image supprimera l'ensemble des annotations de l'image au clic. Les boutons de modification et de suppression ont un effet imm\u00e9diat lors du clic.  </p>"},{"location":"utilisation/#generez-vos-donnees-finales","title":"G\u00e9n\u00e9rez vos donn\u00e9es finales","text":"<p>Dans la barre lat\u00e9rale :</p> <ul> <li>d\u00e9finisser si besoin le d\u00e9calage pour un r\u00e9f\u00e9rentiel 0\u00b0 = Nord</li> </ul> <p>R\u00e9f\u00e9rentiel Nord = 0\u00b0</p> <p>PhotoMapon utilise un r\u00e9f\u00e9rentiel standard d\u2019azimut dans lequel 0\u00b0 correspond au Nord, avec une rotation horaire (90\u00b0 = Est, 180\u00b0 = Sud, 270\u00b0 = Ouest). Cependant, certaines cam\u00e9ras \u2014 notamment les appareils 360\u00b0 ou certaines GoPro \u2014 enregistrent parfois les orientations dans un autre r\u00e9f\u00e9rentiel, par exemple avec 0\u00b0 positionn\u00e9 \u00e0 l\u2019Est. Dans ce cas, l\u2019angle d\u2019orientation affich\u00e9 dans la visionneuse ne correspond pas au r\u00e9f\u00e9rentiel attendu, ce qui fausse la direction de projection et donc la cartographie du point annot\u00e9.</p> <p>Pour corriger cela, PhotoMapon permet d\u2019utiliser un compteur d\u2019ajustement de l\u2019angle, permettant soit de ramener l\u2019image dans un r\u00e9f\u00e9rentiel Nord coh\u00e9rent, soit d\u2019apporter une correction manuelle plus fine lorsque l\u2019orientation EXIF s\u2019av\u00e8re impr\u00e9cise (cas fr\u00e9quent sur les photos prises en mouvement ou en conditions GPS d\u00e9grad\u00e9es).</p> <ul> <li>ajoutez un fichier GPKG en Lambert-93 (EPSG 2154)</li> <li>s\u00e9lectionnez la table de comparaison (polygone)</li> </ul> <p> </p> <p>Cliquez sur \"\ud83d\uddfa\ufe0f Cartographier les \u00e9l\u00e9ments \ud83d\uddfa\ufe0f\" </p> <p>R\u00e9sultats g\u00e9n\u00e9r\u00e9s automatiquement et plac\u00e9s dans le dossier \"resultat\" (cr\u00e9\u00e9 par d\u00e9faut si absent) :</p> <ul> <li>un GPKG enrichi (table de r\u00e9f\u00e9rence mise \u00e0 jour, autres tables si pr\u00e9sentes et cr\u00e9ation d'une table des objets cartographi\u00e9s)</li> <li>un fichier de log retra\u00e7ant les op\u00e9rations</li> <li>les photos annot\u00e9es export\u00e9es dans ce m\u00eame dossier</li> </ul> <p>D\u00e9tail des couches du GeoPackage export\u00e9</p> <p>Voici un r\u00e9sum\u00e9 des couches cr\u00e9\u00e9es dans le fichier GeoPackage lors de l\u2019export des annotations (pr\u00e9fixe phm_). L'ensemble des tables du GPKG d'origine sont renvoy\u00e9es, seule la table fournie est mise \u00e0 jour par les annotations.  </p> Nom de la couche Description Type g\u00e9om\u00e9trique Source / R\u00f4le  principal <code>nom de la table utilisateur</code> G\u00e9om\u00e9trie mise \u00e0 jour par les annotations de l'utilisateur Polygone G\u00e9om\u00e9trie issue du fichier/table utilisateur pour mise \u00e0 jour <code>phm_photo</code> Un point par photo annot\u00e9e, contenant les m\u00e9tadonn\u00e9es EXIF et les annotations associ\u00e9es. Point Issue des m\u00e9tadonn\u00e9es EXIF et JSON d\u2019annotation <code>phm_point_geom</code> Points g\u00e9om\u00e9triques de r\u00e9f\u00e9rence projet\u00e9s utilis\u00e9s pour les calculs d'objets. Point Base de r\u00e9f\u00e9rence pour les traitements spatiaux bruts <code>phm_point_objet_annot</code> Tous les objets annot\u00e9s y compris les doublons, directement issus des clics depuis un \"phm_point_geom\". Point Capture brute des objets annot\u00e9s par l\u2019utilisateur <code>phm_point_ref</code> Points de r\u00e9f\u00e9rence pour recalcul des angles des objets Point Servent \u00e0 g\u00e9n\u00e9rer les objets finaux avec orientation moyenne par groupe <code>phm_ligne_vue</code> Lignes de vue finales depuis les \"point_ref\" vers les objets annot\u00e9s finaux. Ligne (LineString) Visualisation des correspondances entre photos et objets <code>phm_point_objet</code> Objets annot\u00e9s finaux : un seul point par groupe (angle moyen, sans doublons). Point R\u00e9sultat consolid\u00e9 pour la cartographie finale <p>Vous pouvez d\u00e9sactiver la cr\u00e9ation de certaines couches pour ne garder que \"photo\", la couche utilisateur mise \u00e0 jour (et le reste des couches d'origine) et \"point_objet\" en commentant les lignes dans le fichier. utils/geo_utils -&gt; \u00e0 partir de la ligne 464</p>"}]}